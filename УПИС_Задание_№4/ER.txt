@startuml
hide circle

entity "game" {
  *game_id : integer
  --
  is_game_over : boolean
  sum_of_thrown_dice : integer
  is_thrown_two_dice : boolean
  has_current_player_threw_dice : boolean
}

entity "player" {
  *player_id : integer
  --
  player_type : varchar
  fraction_id : integer <<FK>>
  money : integer
  is_active : boolean
}

entity "fraction" {
  *fraction_id : integer
  --
  name_tag : varchar
  description_tag : varchar
  color_hex : varchar
}

entity "building_type" {
  *type_id : integer
  --
  name : varchar
}

entity "building_catalog" {
  *building_catalog_id : integer
  --
  building_sprite : varchar
  fraction_color : varchar
}

entity "building" {
  *building_id : integer
  --
  building_catalog_id : integer <<FK>>
  name_tag : varchar
  description_tag : varchar
  type_id : integer <<FK>>
  min_dice_value : integer
  max_dice_value : integer
  requirement_surface_type : varchar
  emblem_type : varchar
  price : integer
}

entity "player_building" {
  *player_id : integer <<FK>>
  --
  game_id : integer <<FK>>
  building_id : integer <<FK>>
}

entity "player_hand" {
  *hand_id : integer
  --
  game_id : integer <<FK>>
  player_id : integer <<FK>>
  ability_to_replace_count : integer
  ability_to_sell : boolean
}

entity "card" {
  *card_id : integer
  --
  hand_id : integer <<FK>>
  building_id : integer <<FK>>
  slot_index : integer
}

entity "tile" {
  *tile_id : integer
  --
  pos_x : integer
  pos_y : integer
  surface_type : varchar
  owner_player_id : integer <<FK>>
  is_available_for_build : boolean
}

entity "game_move_system" {
  game_id : integer <<FK>>
  move_type : varchar
  step_count : integer
  current_turn_player_id : integer <<FK>>
}

entity "main_base" {
  *base_id : integer
  --
  game_id : integer <<FK>>
  player_id : integer <<FK>>
  active_floors_count : integer
  floors_data : text
}

entity "main_base_floor" {
  *floor_id : integer
  --
  base_id : integer <<FK>>
  floor_type : varchar
  is_active : boolean
}

' Связи
game ||--o{ player
player ||--|| fraction
building_catalog ||--o{ building
building }o--|| building_type

player_building }o--|| game
player_building }o--|| player
building }o--|| player_building
player_building }o--|| tile

player_hand }o--|| game
player_hand ||--|| player
card }o--|| player_hand
card }o--|| building

tile }o--|| player

game_move_system ||--|| game
game_move_system ||--|| player

main_base }o--|| game
main_base }o--|| player
main_base }o--|| building_catalog
main_base_floor }o--|| main_base

@enduml
